type: custom:vertical-stack-in-card
title: Dagens Timpris
style: |
  ha-card {
  box-shadow: 2px;
  background: transparent:
  margin: 15px:
  }
cards:
  - type: custom:apexcharts-card
    experimental:
      color_threshold: true
      brush: true
    now:
      show: true
      label: JUST NU
    graph_span: 24h
    apex_config:
      chart:
        height: 300px
      legend:
        showForSingleSeries: true
      plotOptions:
        bar:
          borderRadius: 2
      yaxis:
        decimalsInFloat: 2
        tickAmount: 10
        forceNiceScale: true
      xaxis:
        labels:
          datetimeFormatter:
            hour: HH
    all_series_config:
      show:
        offset_in_name: false
    header:
      title: ' '
      show: true
      show_states: true
      colorize_states: true
    span:
      start: day
      offset: +0h
    series:
      - entity: sensor.nordpool_kwh_se3_sek_3_095_025
        type: area
        color: orange
        color_threshold:
          - value: -10
            color: cyan
            opacity: 1
          - value: 20
            color: green
          - value: 75
            color: orange
          - value: 150
            color: red
          - value: 300
            color: black
        float_precision: 2
        stroke_width: 2
        name: Dagens timpris
        show:
          in_header: false
          legend_value: false
          extremas: true
        data_generator: |
          return entity.attributes.raw_today.map((start, index) => {
            return [new Date(start["start"]).getTime(), entity.attributes.raw_today[index]["value"]];
          });
      - entity: sensor.nordpool_kwh_se3_sek_3_095_025
        name: Timpris just nu
        color: orange
        type: column
        show:
          in_chart: false
        float_precision: 2
      - entity: sensor.nordpool_kwh_se3_sek_3_095_025
        attribute: average
        type: column
        color: white
        float_precision: 2
        stroke_width: 2
        name: Dagens Snittpris
        group_by:
          duration: 1d
        show:
          in_chart: false
          legend_value: false
      - entity: sensor.nordpool_kwh_se3_sek_3_095_025
        attribute: max
        type: column
        color: red
        float_precision: 2
        stroke_width: 2
        name: Dagens högsta pris
        group_by:
          duration: 1d
        show:
          in_chart: false
          legend_value: false
      - entity: sensor.nordpool_kwh_se3_sek_3_095_025
        attribute: min
        type: column
        color: green
        float_precision: 2
        stroke_width: 2
        name: Dagens lägsta pris
        group_by:
          duration: 1d
        show:
          in_chart: false
          legend_value: false
      - entity: sensor.nordpool_diy_sensor
        type: line
        color: purple
        float_precision: 2
        stroke_width: 2
        name: Värmepumpens högsta pris
        group_by:
          duration: 1d
        show:
          in_chart: false
          legend_value: false
